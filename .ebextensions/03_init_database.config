# .ebextensions/03_init_database.config
# Configuración para ejecutar automáticamente el script de inicialización de base de datos
# Este archivo se ejecuta durante el despliegue en AWS Elastic Beanstalk

container_commands:
  01_check_database:
    # Verificar el estado de la base de datos antes de inicializar
    command: "python check_database.py 2>&1 | tee /tmp/check_db.log || echo 'Diagnóstico completado con errores'"
    leader_only: true
    ignoreErrors: true
  02_simple_init:
    # Intentar inicialización simplificada primero (solo tablas)
    command: "python simple_init.py 2>&1 | tee /tmp/simple_init.log"
    leader_only: true
    ignoreErrors: true
  03_init_database:
    # Ejecutar el script completo de inicialización si el simple funcionó
    # Esto creará el usuario administrador y datos adicionales
    command: "python setup_database.py --mode init 2>&1 | tee /tmp/init_db.log || echo 'Inicialización completa falló, pero tablas ya están creadas'"
    # Solo ejecutar en la instancia líder para evitar conflictos
    leader_only: true
    # Ignorar errores ya que las tablas ya están creadas
    ignoreErrors: true
  04_verify_admin:
    # Verificar las credenciales del usuario administrador después de la inicialización
    command: "python verify_admin.py 2>&1 | tee /tmp/verify_admin.log || echo 'Verificación de admin completada con errores'"
    leader_only: true
    ignoreErrors: true